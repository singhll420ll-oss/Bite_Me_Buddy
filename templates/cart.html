
{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/services">Services</a></li>
                <li class="breadcrumb-item active">Shopping Cart</li>
            </ol>
        </nav>
        
        <h2 class="text-primary"><i class="fas fa-shopping-cart"></i> Your Shopping Cart</h2>
        <p class="lead">Review your items before checkout</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Cart Items -->
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Cart Items</h5>
            </div>
            <div class="card-body">
                <div id="cart-items-container">
                    <p class="text-center text-muted">Loading cart items...</p>
                </div>
            </div>
        </div>
        
        <!-- Delivery Information -->
        <div class="card shadow mt-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-truck"></i> Delivery Information</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="delivery-address" class="form-label">Delivery Address</label>
                    <textarea class="form-control" id="delivery-address" rows="3" placeholder="Enter your delivery address"></textarea>
                </div>
                <div class="mb-3">
                    <label for="delivery-instructions" class="form-label">Special Instructions</label>
                    <textarea class="form-control" id="delivery-instructions" rows="2" placeholder="Any special instructions for delivery"></textarea>
                </div>
                <div class="mb-3">
                    <label for="preferred-time" class="form-label">Preferred Delivery Time</label>
                    <select class="form-select" id="preferred-time">
                        <option value="asap">As Soon As Possible</option>
                        <option value="30min">Within 30 minutes</option>
                        <option value="1hour">Within 1 hour</option>
                        <option value="2hours">Within 2 hours</option>
                        <option value="specific">Specific Time</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Order Summary -->
        <div class="card shadow sticky-top" style="top: 20px;">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-receipt"></i> Order Summary</h5>
            </div>
            <div class="card-body">
                <div id="order-summary">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span id="subtotal">₹0.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Delivery Charge</span>
                        <span id="delivery-charge">₹30.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tax (5%)</span>
                        <span id="tax">₹0.00</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total</strong>
                        <strong id="total-amount">₹0.00</strong>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-success" onclick="proceedToCheckout()">
                            <i class="fas fa-lock"></i> Proceed to Checkout
                        </button>
                        <a href="/services" class="btn btn-outline-primary">
                            <i class="fas fa-plus"></i> Add More Items
                        </a>
                        <button class="btn btn-outline-danger" onclick="clearCart()">
                            <i class="fas fa-trash"></i> Clear Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Payment Methods -->
        <div class="card shadow mt-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-credit-card"></i> Payment Methods</h5>
            </div>
            <div class="card-body">
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="payment-method" id="cod" value="cod" checked>
                    <label class="form-check-label" for="cod">
                        <i class="fas fa-money-bill-wave"></i> Cash on Delivery
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="payment-method" id="card" value="card">
                    <label class="form-check-label" for="card">
                        <i class="fas fa-credit-card"></i> Credit/Debit Card
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="payment-method" id="upi" value="upi">
                    <label class="form-check-label" for="upi">
                        <i class="fas fa-mobile-alt"></i> UPI Payment
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let cart = {};
    
    function loadCart() {
        let savedCart = localStorage.getItem('bite_me_buddy_cart');
        if (savedCart) {
            cart = JSON.parse(savedCart);
            renderCartItems();
            calculateTotals();
        } else {
            document.getElementById('cart-items-container').innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
                    <h4>Your cart is empty</h4>
                    <p class="text-muted">Add some delicious items to your cart!</p>
                    <a href="/services" class="btn btn-primary">
                        <i class="fas fa-utensils"></i> Browse Services
                    </a>
                </div>
            `;
        }
    }
    
    function renderCartItems() {
        let container = document.getElementById('cart-items-container');
        let html = '';
        
        if (Object.keys(cart).length === 0) {
            html = `
                <div class="text-center py-5">
                    <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
                    <h4>Your cart is empty</h4>
                    <p class="text-muted">Add some delicious items to your cart!</p>
                    <a href="/services" class="btn btn-primary">
                        <i class="fas fa-utensils"></i> Browse Services
                    </a>
                </div>
            `;
        } else {
            html = '<table class="table table-hover">';
            html += '<thead><tr><th>Item</th><th>Price</th><th>Quantity</th><th>Total</th><th>Action</th></tr></thead>';
            html += '<tbody>';
            
            for (let itemId in cart) {
                let item = cart[itemId];
                let total = item.price * item.quantity;
                
                html += `
                    <tr id="cart-item-${itemId}">
                        <td>
                            <strong>${item.name}</strong>
                        </td>
                        <td>₹${item.price.toFixed(2)}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(${itemId}, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="px-3">${item.quantity}</span>
                                <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(${itemId}, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        <td>₹${total.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removeItem(${itemId})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
        }
        
        container.innerHTML = html;
    }
    
    function updateQuantity(itemId, change) {
        if (cart[itemId]) {
            cart[itemId].quantity += change;
            
            if (cart[itemId].quantity <= 0) {
                delete cart[itemId];
            }
            
            saveCart();
            renderCartItems();
            calculateTotals();
        }
    }
    
    function removeItem(itemId) {
        if (confirm('Remove this item from cart?')) {
            delete cart[itemId];
            saveCart();
            renderCartItems();
            calculateTotals();
        }
    }
    
    function calculateTotals() {
        let subtotal = 0;
        
        for (let itemId in cart) {
            let item = cart[itemId];
            subtotal += item.price * item.quantity;
        }
        
        let deliveryCharge = 30.00;
        let tax = subtotal * 0.05;
        let total = subtotal + deliveryCharge + tax;
        
        document.getElementById('subtotal').textContent = '₹' + subtotal.toFixed(2);
        document.getElementById('delivery-charge').textContent = '₹' + deliveryCharge.toFixed(2);
        document.getElementById('tax').textContent = '₹' + tax.toFixed(2);
        document.getElementById('total-amount').textContent = '₹' + total.toFixed(2);
    }
    
    function saveCart() {
        localStorage.setItem('bite_me_buddy_cart', JSON.stringify(cart));
    }
    
    function clearCart() {
        if (confirm('Are you sure you want to clear your cart?')) {
            cart = {};
            saveCart();
            renderCartItems();
            calculateTotals();
        }
    }
    
    function proceedToCheckout() {
        if (Object.keys(cart).length === 0) {
            alert('Your cart is empty. Add some items first!');
            return;
        }
        
        let address = document.getElementById('delivery-address').value;
        if (!address.trim()) {
            alert('Please enter delivery address');
            return;
        }
        
        // Save order data
        let orderData = {
            items: cart,
            address: address,
            instructions: document.getElementById('delivery-instructions').value,
            deliveryTime: document.getElementById('preferred-time').value,
            paymentMethod: document.querySelector('input[name="payment-method"]:checked').value,
            subtotal: parseFloat(document.getElementById('subtotal').textContent.replace('₹', '')),
            deliveryCharge: parseFloat(document.getElementById('delivery-charge').textContent.replace('₹', '')),
            tax: parseFloat(document.getElementById('tax').textContent.replace('₹', '')),
            total: parseFloat(document.getElementById('total-amount').textContent.replace('₹', ''))
        };
        
        localStorage.setItem('bite_me_buddy_order', JSON.stringify(orderData));
        
        // Redirect to checkout
        window.location.href = '/checkout';
    }
    
    // Load cart on page load
    document.addEventListener('DOMContentLoaded', loadCart);
</script>
{% endblock %}
